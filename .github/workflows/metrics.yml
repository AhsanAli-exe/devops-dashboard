name: Metrics Collection

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  collect-metrics:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Collect workflow metrics
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "ðŸ“Š Collecting CI/CD metrics..."
        
        # Get recent workflow runs
        curl -H "Authorization: token $GITHUB_TOKEN" \
             -H "Accept: application/vnd.github.v3+json" \
             "https://api.github.com/repos/${{ github.repository }}/actions/runs?per_page=10" \
             > workflow_runs.json
        
        # Parse and display metrics
        echo "Recent Workflow Runs:"
        cat workflow_runs.json | grep -o '"conclusion":"[^"]*"' | head -5 || echo "No runs found"
        
    - name: Calculate success rate
      run: |
        echo "ðŸ“ˆ Calculating CI/CD success rate..."
        echo "Total runs: TBD"
        echo "Successful runs: TBD"
        echo "Failed runs: TBD"
        echo "Success rate: TBD%"
        
    - name: Display metrics summary
      run: |
        echo "================================"
        echo "ðŸ“Š CI/CD Metrics Summary"
        echo "================================"
        echo "Repository: ${{ github.repository }}"
        echo "Branch: ${{ github.ref_name }}"
        echo "Last updated: $(date -u)"
        echo "================================"

        